<!DOCTYPE html>
<html lang="ru">
<head>
    <%- include('../partials/head') %>
    <link rel="stylesheet" href="/style/page/rating.css">
    <title>–†–µ–π—Ç–∏–Ω–≥ - BilimHub</title>
</head>
<body>
    <%- include('../partials/header') %>

    <div class="rating-container">
        <div class="page-header">
            <h1>üèÜ –†–µ–π—Ç–∏–Ω–≥ —É—á–µ–Ω–∏–∫–æ–≤</h1>
            <p>–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –æ–±—É—á–µ–Ω–∏—è</p>
        </div>

        <div id="loading" class="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...
        </div>

        <div id="rating-content" style="display: none;">
            <div class="rating-table-container">
                <table class="rating-table">
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–£—á–µ–Ω–∏–∫</th>
                            <th>–ë–∞–ª–ª—ã</th>
                            <th>–£—Ä–æ–≤–µ–Ω—å</th>
                            <th>–ó–∞–≤–µ—Ä—à–µ–Ω–æ –ª–µ–∫—Ü–∏–π</th>
                            <th>–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤</th>
                        </tr>
                    </thead>
                    <tbody id="rating-tbody">
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="empty-state" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üìä</div>
            <h2>–†–µ–π—Ç–∏–Ω–≥ –ø–æ–∫–∞ –ø—É—Å—Ç</h2>
            <p>–ù–∞—á–Ω–∏—Ç–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∫—É—Ä—Å—ã, —á—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤!</p>
        </div>
    </div>

    <%- include('../partials/footer') %>

    <script>
        async function loadRating() {
            try {
                const response = await fetch('/api/ratings');
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞');
                }

                const ratings = await response.json();

                document.getElementById('loading').style.display = 'none';

                if (ratings.length === 0) {
                    document.getElementById('empty-state').style.display = 'block';
                    return;
                }

                document.getElementById('rating-content').style.display = 'block';

                const tbody = document.getElementById('rating-tbody');
                tbody.innerHTML = '';

                ratings.forEach((rating, index) => {
                    const row = createRatingRow(rating, index + 1);
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:', error);
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞';
            }
        }

        function createRatingRow(rating, rank) {
            const tr = document.createElement('tr');

            const rankClass = rank <= 3 ? `rank-${rank}` : '';
            const levelClass = getLevelClass(rating.level);
            const userInitial = rating.user.name.charAt(0).toUpperCase();

            tr.innerHTML = `
                <td class="rank-cell ${rankClass}">${getRankEmoji(rank)} ${rank}</td>
                <td>
                    <div class="user-info">
                        <div class="user-avatar">${userInitial}</div>
                        <span class="user-name">${rating.user.name}</span>
                    </div>
                </td>
                <td class="score-cell">${rating.totalScore}</td>
                <td>
                    <span class="level-badge ${levelClass}">${rating.level}</span>
                </td>
                <td class="stats-cell">${rating.completedLectures}</td>
                <td class="stats-cell">${rating.completedTests}</td>
            `;

            return tr;
        }

        function getRankEmoji(rank) {
            if (rank === 1) return 'ü•á';
            if (rank === 2) return 'ü•à';
            if (rank === 3) return 'ü•â';
            return '';
        }

        function getLevelClass(level) {
            const levelMap = {
                '–ù–æ–≤–∏—á–æ–∫': 'level-novice',
                '–°—Ä–µ–¥–Ω–∏–π': 'level-intermediate',
                '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π': 'level-advanced',
                '–≠–∫—Å–ø–µ—Ä—Ç': 'level-expert'
            };
            return levelMap[level] || 'level-novice';
        }

        loadRating();
    </script>
</body>
</html>
