<!DOCTYPE html>
<html lang="ru">
<head>
    <%- include('../partials/head') %>
    <link rel="stylesheet" href="/style/page/theme-detail.css">
    <title>–õ–µ–∫—Ü–∏–∏ - BilimHub</title>
</head>
<body>
    <%- include('../partials/header') %>

    <div class="theme-container">
        <a href="/themes" class="back-button">‚Üê –ù–∞–∑–∞–¥ –∫ –∫—É—Ä—Å–∞–º</a>

        <div id="loading" class="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–∫—Ü–∏–π...
        </div>

        <div id="theme-content" style="display: none;">
            <div class="theme-header">
                <h1 id="theme-title"></h1>
                <p id="theme-description"></p>
            </div>

            <div id="lectures-list" class="lectures-list">
                <!-- –õ–µ–∫—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
    </div>

    <%- include('../partials/footer') %>

    <script>
        const themeId = window.location.pathname.split('/')[2];

        async function loadTheme() {
            try {
                const response = await fetch(`/api/themes/${themeId}`);
                
                if (!response.ok) {
                    throw new Error('–¢–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }

                const theme = await response.json();

                document.getElementById('loading').style.display = 'none';
                document.getElementById('theme-content').style.display = 'block';

                document.getElementById('theme-title').textContent = theme.title;
                document.getElementById('theme-description').textContent = theme.description;

                const lecturesList = document.getElementById('lectures-list');
                
                if (theme.lectures && theme.lectures.length > 0) {
                    theme.lectures.forEach((lecture, index) => {
                        const card = createLectureCard(lecture, index + 1);
                        lecturesList.appendChild(card);
                    });
                } else {
                    lecturesList.innerHTML = '<p style="text-align: center; color: #7f8c8d;">–õ–µ–∫—Ü–∏–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–º—ã:', error);
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–º—ã';
            }
        }

        function createLectureCard(lecture, number) {
            const card = document.createElement('div');
            card.className = 'lecture-card';
            
            const isLocked = lecture.isLocked || false; // TODO: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
            
            if (isLocked) {
                card.classList.add('locked');
            } else {
                card.onclick = () => window.location.href = `/lectures/${lecture.id}`;
            }

            card.innerHTML = `
                <div class="lecture-number">${number}</div>
                <div class="lecture-content">
                    <h3 class="lecture-title">${lecture.title}</h3>
                    <div class="lecture-meta">
                        <span>‚è±Ô∏è ${lecture.duration || 15} –º–∏–Ω</span>
                        <span class="lecture-status ${isLocked ? 'status-locked' : 'status-in-progress'}">
                            <span class="status-icon">${isLocked ? 'üîí' : '‚ñ∂Ô∏è'}</span>
                            ${isLocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ' : '–î–æ—Å—Ç—É–ø–Ω–æ'}
                        </span>
                    </div>
                </div>
            `;

            return card;
        }

        loadTheme();
    </script>
</body>
</html>
