<!DOCTYPE html>
<html lang="ru">
<head>
    <%- include('../partials/head') %>
    <link rel="stylesheet" href="/style/page/themes.css">
    <title>–û–±—É—á–µ–Ω–∏–µ - BilimHub</title>
</head>
<body>
    <%- include('../partials/header') %>

    <div class="themes-container">
        <div class="page-header">
            <h1>üìö –ö—É—Ä—Å—ã –æ–±—É—á–µ–Ω–∏—è</h1>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –∏ –Ω–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π –ø—É—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏</p>
        </div>

        <div id="loading" class="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤...
        </div>

        <div id="themes-grid" class="themes-grid" style="display: none;">
            <!-- –¢–µ–º—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>

        <div id="empty-state" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üì≠</div>
            <h2>–ö—É—Ä—Å—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</h2>
            <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è</p>
        </div>
    </div>

    <%- include('../partials/footer') %>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º
        async function loadThemes() {
            try {
                const response = await fetch('/api/themes');
                const themes = await response.json();

                document.getElementById('loading').style.display = 'none';

                if (themes.length === 0) {
                    document.getElementById('empty-state').style.display = 'block';
                    return;
                }

                document.getElementById('themes-grid').style.display = 'grid';
                const grid = document.getElementById('themes-grid');

                themes.forEach(theme => {
                    const card = createThemeCard(theme);
                    grid.appendChild(card);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–º:', error);
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤';
            }
        }

        function createThemeCard(theme) {
            const card = document.createElement('div');
            card.className = 'theme-card';
            card.onclick = () => window.location.href = `/themes/${theme.id}`;

            const lecturesCount = theme.lectures ? theme.lectures.length : 0;

            const imageHtml = theme.image 
            ? `<img src="${theme.image}" alt="${theme.title}" class="theme-image" style="object-fit: cover;">` 
            : '<div class="theme-image"></div>';
        
        card.innerHTML = `
                ${imageHtml}
                <div class="theme-content">
                    <h3 class="theme-title">${theme.title}</h3>
                    <p class="theme-description">${theme.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</p>
                    <div class="theme-meta">
                        <span class="lectures-count">${lecturesCount} ${getLecturesWord(lecturesCount)}</span>
                        <button class="start-button" onclick="event.stopPropagation(); window.location.href='/themes/${theme.id}'">
                            –ù–∞—á–∞—Ç—å
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        function getLecturesWord(count) {
            if (count % 10 === 1 && count % 100 !== 11) return '–ª–µ–∫—Ü–∏—è';
            if ([2, 3, 4].includes(count % 10) && ![12, 13, 14].includes(count % 100)) return '–ª–µ–∫—Ü–∏–∏';
            return '–ª–µ–∫—Ü–∏–π';
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadThemes();
    </script>
</body>
</html>
