<!DOCTYPE html>
<html lang="ru">
<head>
    <%- include('../partials/head') %>
    <link rel="stylesheet" href="/style/page/admin.css">
    <title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - BilimHub</title>
</head>
<body>
    <%- include('../partials/header') %>

    <div class="admin-container">
        <div class="admin-header">
            <h1>üõ†Ô∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
            <span>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <%= user.name %>!</span>
        </div>

        <div id="loading" class="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        </div>

        <div id="admin-content" style="display: none;">
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-value" id="themes-count">0</div>
                    <div class="stat-label">–¢–µ–º –∫—É—Ä—Å–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìñ</div>
                    <div class="stat-value" id="lectures-count">0</div>
                    <div class="stat-label">–õ–µ–∫—Ü–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-value" id="tests-count">0</div>
                    <div class="stat-label">–¢–µ—Å—Ç–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="users-count">0</div>
                    <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
            </div>

            <div class="admin-sections">
                <div class="admin-section">
                    <div class="section-header">
                        <h2 class="section-title">–¢–µ–º—ã –∫—É—Ä—Å–æ–≤</h2>
                        <button class="add-button" onclick="openThemeModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–º—É
                        </button>
                    </div>
                    <div id="themes-list" class="items-list">
                        <!-- –¢–µ–º—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>

                <div class="admin-section">
                    <div class="section-header">
                        <h2 class="section-title">–õ–µ–∫—Ü–∏–∏</h2>
                        <button class="add-button" onclick="openLectureModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫—Ü–∏—é
                        </button>
                    </div>
                    <div id="lectures-list" class="items-list">
                        <!-- –õ–µ–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>

                <div class="admin-section">
                    <div class="section-header">
                        <h2 class="section-title">–¢–µ—Å—Ç—ã</h2>
                        <button class="add-button" onclick="openTestModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç
                        </button>
                    </div>
                    <div id="tests-list" class="items-list">
                        <!-- –¢–µ—Å—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ç–µ–º—ã -->
    <div id="theme-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="theme-modal-title">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–º—É</h3>
                <button class="close-button" onclick="closeThemeModal()">‚úï</button>
            </div>
            <form id="theme-form">
                <input type="hidden" id="theme-id">
                <div class="form-group">
                    <label for="theme-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã *</label>
                    <input type="text" id="theme-title" required>
                </div>
                <div class="form-group">
                    <label for="theme-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="theme-description"></textarea>
                </div>
                <div class="form-group">
                    <label for="theme-image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–º—ã</label>
                    <input type="file" id="theme-image-file" accept="image/*" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                    <small style="color: #7f8c8d; display: block; margin-top: 0.5rem;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (jpg, png, gif, webp). –ú–∞–∫—Å: 5MB</small>
                    <div id="image-preview" style="margin-top: 1rem; display: none;">
                        <img id="image-preview-img" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 6px;">
                    </div>
                    <input type="hidden" id="theme-image">
                </div>
                <div class="form-group">
                    <label for="theme-order">–ü–æ—Ä—è–¥–æ–∫</label>
                    <input type="number" id="theme-order" value="0">
                </div>
                <button type="submit" class="submit-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ª–µ–∫—Ü–∏–∏ -->
    <div id="lecture-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="lecture-modal-title">–î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫—Ü–∏—é</h3>
                <button class="close-button" onclick="closeLectureModal()">‚úï</button>
            </div>
            <form id="lecture-form">
                <input type="hidden" id="lecture-id">
                <div class="form-group">
                    <label for="lecture-theme">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É *</label>
                    <select id="lecture-theme" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lecture-title">–ù–∞–∑–≤–∞–Ω–∏–µ –ª–µ–∫—Ü–∏–∏ *</label>
                    <input type="text" id="lecture-title" required>
                </div>
                <div class="form-group">
                    <label for="lecture-content">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (Markdown) *</label>
                    <textarea id="lecture-content" required style="min-height: 250px;"></textarea>
                </div>
                <div class="form-group">
                    <label for="lecture-video">–í–∏–¥–µ–æ —Ñ–∞–π–ª</label>
                    <input type="file" id="lecture-video-file" accept="video/*" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                    <small style="color: #7f8c8d; display: block; margin-top: 0.5rem;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ (mp4, avi, mkv, mov, webm). –ú–∞–∫—Å: 100MB</small>
                    <div id="video-preview" style="margin-top: 1rem; display: none;">
                        <video id="video-preview-player" controls style="width: 100%; max-height: 300px; border-radius: 6px;"></video>
                    </div>
                    <input type="hidden" id="lecture-video">
                </div>
                <div class="form-group">
                    <label for="lecture-duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω)</label>
                    <input type="number" id="lecture-duration" value="15">
                </div>
                <div class="form-group">
                    <label for="lecture-order">–ü–æ—Ä—è–¥–æ–∫</label>
                    <input type="number" id="lecture-order" value="0">
                </div>
                <button type="submit" class="submit-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ -->
    <div id="test-modal" class="modal">
        <div class="modal-content" style="max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="position: sticky; top: 0; background: white; z-index: 10;">
                <h3 class="modal-title" id="test-modal-title">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç</h3>
                <button class="close-button" onclick="closeTestModal()">‚úï</button>
            </div>
            <form id="test-form" style="padding: 2rem;">
                <input type="hidden" id="test-id">
                <div class="form-group">
                    <label for="test-lecture">–í—ã–±–µ—Ä–∏—Ç–µ –ª–µ–∫—Ü–∏—é *</label>
                    <select id="test-lecture" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ª–µ–∫—Ü–∏—é --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="test-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ *</label>
                    <input type="text" id="test-title" required>
                </div>
                <div class="form-group">
                    <label for="test-number">–ù–æ–º–µ—Ä —Ç–µ—Å—Ç–∞ (1 –∏–ª–∏ 2) *</label>
                    <select id="test-number" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="1">–¢–µ—Å—Ç 1 (–æ—Å–Ω–æ–≤–Ω–æ–π)</option>
                        <option value="2">–¢–µ—Å—Ç 2 (–ø–µ—Ä–µ—ç–∫–∑–∞–º–µ–Ω)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="test-passing-score">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è (%) *</label>
                    <input type="number" id="test-passing-score" min="0" max="100" value="70" required>
                </div>
                <div class="form-group">
                    <label for="test-time-limit">–í—Ä–µ–º—è –Ω–∞ —Ç–µ—Å—Ç (–º–∏–Ω)</label>
                    <input type="number" id="test-time-limit" min="1" value="30">
                </div>

                <hr style="margin: 2rem 0;">
                <h4 style="margin-bottom: 1rem;">–í–æ–ø—Ä–æ—Å—ã</h4>
                <div id="questions-container" style="margin-bottom: 1rem;"></div>
                <button type="button" class="add-button" onclick="addQuestion()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>

                <hr style="margin: 2rem 0;">
                <button type="submit" class="submit-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç</button>
            </form>
        </div>
    </div>

    <%- include('../partials/footer') %>

    <script src="/js/admin.js"></script>
</body>
</html>
